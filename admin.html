<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | –ö–∞–ª—å—Ç–£—Å–ª—É–≥–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body style="display: block; padding: 20px;">

    <div class="container" style="max-width: 800px; margin: 0 auto;">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <h1>üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏</h1>
            <button onclick="location.href='index.html'" class="btn-exit">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
        </div>

        <div id="apps-list" style="margin-top: 30px;">
            <p class="subtitle">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞—è–≤–æ–∫...</p>
        </div>
    </div>

    <script>
        // –í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï SUPABASE
        const SUPABASE_URL = 'https://exbhxsdwqznmroxrzxjp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4Ymh4c2R3cXpubXJveHJ6eGpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDUzMzksImV4cCI6MjA4NzY4MTMzOX0.CUpzfJCrhghGNZKMK4xboXA7ZdSbYArWBSW4LpMevVk';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function loadApps() {
            const { data, error } = await supabaseClient
                .from('applications')
                .select('*')
                .eq('status', 'pending')
                .order('created_at', { ascending: false });

            const list = document.getElementById('apps-list');
            list.innerHTML = '';

            if (data.length === 0) {
                list.innerHTML = '<p class="subtitle">–ù–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ –ø–æ–∫–∞ –Ω–µ—Ç.</p>';
                return;
            }

            data.forEach(app => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.textAlign = 'left';
                card.style.marginBottom = '20px';
                card.style.cursor = 'default';

                // –ö—Ä–∞—Å–∏–≤–æ —Ä–∞–∑–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã (–ú–∞—Ä–∫–∞, –ú–æ–¥–µ–ª—å –∏ —Ç.–¥.)
                let infoHtml = '';
                if (typeof app.data === 'object') {
                    infoHtml = Object.entries(app.data)
                        .map(([key, val]) => <b>${key}:</b> ${val})
                        .join('<br>');
                } else {
                    infoHtml = app.data;
                }

                card.innerHTML = 
                    <div style="display:flex; justify-content:space-between; align-items:start;">
                        <div>
                            <span style="color:var(--accent-purple); font-weight:bold;"># ${app.type.toUpperCase()}</span>
                            <h3 style="margin: 5px 0;">–û—Ç: ${app.username}</h3>
                            <div style="color:var(--text-dim); font-size:14px;">${infoHtml}</div>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button onclick="approveApp('${app.id}')" class="btn-main" style="width:auto; padding:10px; background:#10b981;">‚úÖ</button>
                            <button onclick="rejectApp('${app.id}')" class="btn-main" style="width:auto; padding:10px; background:#ef4444;">‚ùå</button>
                        </div>
                    </div>
                ;
                list.appendChild(card);
            });
        }

        async function approveApp(id) {
            const { error } = await supabaseClient
                .from('applications')
                .update({ status: 'approved' })
                .eq('id', id);
            
            if (!error) { alert('–û–¥–æ–±—Ä–µ–Ω–æ!'); loadApps(); }
        }

        async function rejectApp(id) {
            const { error } = await supabaseClient
                .from('applications')
                .update({ status: 'rejected' })
                .eq('id', id);
            
            if (!error) { alert('–û—Ç–∫–ª–æ–Ω–µ–Ω–æ!'); loadApps(); }
        }

        window.onload = loadApps;
    </script>
</body>
</html>
