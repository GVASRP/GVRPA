<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Регистрация ТС</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body style="background:#000;color:#fff;text-align:center;font-family:sans-serif;">
    <div style="margin-top:50px;">
        <input type="text" id="b" placeholder="Brand" style="display:block;margin:10px auto;">
        <input type="text" id="m" placeholder="Model" style="display:block;margin:10px auto;">
        <button onclick="send()" style="padding:10px 20px;">ОТПРАВИТЬ</button>
    </div>

    <script>
        const S_URL = 'https://exbhxsdwqznmroxrzxjp.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4Ymh4c2R3cXpubXJveHJ6eGpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDUzMzksImV4cCI6MjA4NzY4MTMzOX0.CUpzfJCrhghGNZKMK4xboXA7ZdSbYArWBSW4LpMevVk';
        const sb = supabase.createClient(S_URL, S_KEY);

        async function send() {
            const brand = document.getElementById('b').value;
            const model = document.getElementById('m').value;
            
            if (brand == "" || model == "") return alert("Empty!");

            const u = localStorage.getItem('gvr_user');
            if (!u) return alert("No user!");
            const user = JSON.parse(u);

            try {
                const { error } = await sb.from('applications').insert([{ 
                    username: user.username, 
                    type: 'car', 
                    data: { brand, model }, 
                    status: 'pending' 
                }]);
                if (error) throw error;
                alert("Done!");
            } catch (e) {
                alert(e.message);
            }
        }
    </script>
</body>
</html>
