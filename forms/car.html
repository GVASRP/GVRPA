<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–≤—Ç–æ | –ö–∞–ª—å—Ç–£—Å–ª—É–≥–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="../style.css"> </head>
<body style="display: flex; justify-content: center; align-items: center; min-height: 100vh;">

    <div class="auth-card" style="max-width: 500px;">
        <h1>üöó –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ê–í–¢–û</h1>
        <p class="subtitle">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–≥–æ –ø–æ —à–∞–±–ª–æ–Ω—É</p>

        <div id="car-form">
            <input type="text" id="car-model" placeholder="–ú–∞—Ä–∫–∞ –∏ –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2021 Audi R8)">
            <input type="text" id="car-plate" placeholder="–ñ–µ–ª–∞–µ–º—ã–π –Ω–æ–º–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä: AAA-111)">
            <input type="text" id="car-color" placeholder="–¶–≤–µ—Ç –∫—É–∑–æ–≤–∞">
            <textarea id="car-extra" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (—Å—Å—ã–ª–∫–∏ –Ω–∞ —Å–∫—Ä–∏–Ω—ã –∞–≤—Ç–æ –≤ –≤–∞—à–µ–º –≥–∞—Ä–∞–∂–µ)"></textarea>
            
            <button onclick="sendCarApp()" class="btn-main">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
            <button onclick="location.href='../index.html'" class="btn-exit" style="width: 100%; margin-top: 10px; border: none;">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <script>
        // –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∞–∑—É (–∑–∞–º–µ–Ω–∏ –∫–ª—é—á–∏ –Ω–∞ —Å–≤–æ–∏!)
        const supabaseClient = supabase.createClient('–¢–í–û–ô_URL', '–¢–í–û–ô_KEY');

        async function sendCarApp() {
            const user = JSON.parse(localStorage.getItem('gvr_user'));
            if(!user) return alert("–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã!");

            const carData = {
                model: document.getElementById('car-model').value,
                plate: document.getElementById('car-plate').value,
                color: document.getElementById('car-color').value,
                extra: document.getElementById('car-extra').value
            };

            const { error } = await supabaseClient
                .from('applications')
                .insert([{ 
                    username: user.username, 
                    type: 'car', 
                    data: carData, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ JSON –æ–±—ä–µ–∫—Ç
                    status: 'pending' 
                }]);

            if (error) alert("–û—à–∏–±–∫–∞");
            else {
                alert("–ó–∞—è–≤–∫–∞ –Ω–∞ –∞–≤—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
                window.location.href = '../index.html';
            }
        }
    </script>
</body>
</html>
