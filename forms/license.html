<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –õ–∏—Ü–µ–Ω–∑–∏—è | –ö–∞–ª—å—Ç–£—Å–ª—É–≥–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="../style.css">
</head>
<body style="display: block; padding: 40px 20px;">

    <div class="auth-card" style="max-width: 600px; margin: 0 auto;">
        <h1>üí≥ –í–û–î–ò–¢–ï–õ–¨–°–ö–ê–Ø –õ–ò–¶–ï–ù–ó–ò–Ø</h1>
        <p class="subtitle">–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ —ç–∫–∑–∞–º–µ–Ω–∞</p>

        <div id="license-form" style="text-align: left;">
            <label>–ò–º—è –∏ –§–∞–º–∏–ª–∏—è (Name):</label>
            <input type="text" id="lic-name" placeholder="Ivan Ivanov">

            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (D.O.B):</label>
            <input type="text" id="lic-dob" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì">

            <label>–í–∞—à –∞–¥—Ä–µ—Å:</label>
            <input type="text" id="lic-address" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –Ω–æ–º–µ—Ä –¥–æ–º–∞">

            <label>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:</label>
            <input type="text" id="lic-issue" placeholder="–ß–∏—Å–ª–æ/–ú–µ—Å—è—Ü/–ì–æ–¥">

            <label>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:</label>
            <input type="text" id="lic-expiry" value="10 –ª–µ—Ç" readonly style="color: var(--text-dim); cursor: not-allowed;">

            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            <select id="lic-cat" style="width:100%; padding:12px; background:rgba(255,255,255,0.05); color:white; border:1px solid rgba(255,255,255,0.1); border-radius:12px; margin:10px 0;">
                <option value="A" style="background:#1a1425;">A ‚Äî –¢—Ä–∞–∫–∏ / –ë–æ–ª—å—à–∏–µ –ø—Ä–∏—Ü–µ–ø—ã</option>
                <option value="B" style="background:#1a1425;" selected>B ‚Äî –õ–µ–≥–∫–æ–≤—ã–µ (B+ –ú–µ—Ö–∞–Ω–∏–∫–∞)</option>
                <option value="C" style="background:#1a1425;">C ‚Äî –¢—Ä–∞–∫–∏ / –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–∏—Ü–µ–ø—ã</option>
            </select>

            <h3 style="margin-top: 25px; color: var(--accent-purple); border-bottom: 1px solid rgba(139, 92, 246, 0.3); padding-bottom: 5px;">–î–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞</h3>
            
            <label>Telegram –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞:</label>
            <input type="text" id="inst-tg" placeholder="@username">

            <label>–ù–∏–∫ –≤ Roblox –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞:</label>
            <input type="text" id="inst-nick" placeholder="Roblox_Nick">

            <label>–û—Ü–µ–Ω–∫–∞ –∑–∞ —ç–∫–∑–∞–º–µ–Ω (–ø–æ 10-–±–∞–ª—å–Ω–æ–π —à–∫–∞–ª–µ):</label>
            <input type="number" id="lic-score" min="1" max="10" placeholder="–û—Ç 1 –¥–æ 10">

            <button onclick="sendLicenseApp()" class="btn-main" style="margin-top: 20px;">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
            <button onclick="location.href='../index.html'" class="btn-exit" style="width: 100%; margin-top: 10px; border: none;">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://exbhxsdwqznmroxrzxjp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4Ymh4c2R3cXpubXJveHJ6eGpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDUzMzksImV4cCI6MjA4NzY4MTMzOX0.CUpzfJCrhghGNZKMK4xboXA7ZdSbYArWBSW4LpMevVk';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function sendLicenseApp() {
            const user = JSON.parse(localStorage.getItem('gvr_user'));
            if(!user) return alert("–í—ã –Ω–µ –≤–æ—à–ª–∏!");

            const formData = {
                full_name: document.getElementById('lic-name').value,
                dob: document.getElementById('lic-dob').value,
                address: document.getElementById('lic-address').value,
                issue_date: document.getElementById('lic-issue').value,
                expiry: document.getElementById('lic-expiry').value,
                category: document.getElementById('lic-cat').value,
                instructor_tg: document.getElementById('inst-tg').value,
                instructor_nick: document.getElementById('inst-nick').value,
                score: document.getElementById('lic-score').value
            };

            if(!formData.full_name  !formData.instructor_nick  !formData.score) {
                return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è, –≤–∫–ª—é—á–∞—è –¥–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞!");
            }

const { error } = await supabaseClient
                .from('applications')
                .insert([{ 
                    username: user.username, 
                    type: 'license', 
                    data: formData, 
                    status: 'pending' 
                }]);

            if (error) alert("–û—à–∏–±–∫–∞: " + error.message);
            else {
                alert("–ó–∞—è–≤–∫–∞ –Ω–∞ –ª–∏—Ü–µ–Ω–∑–∏—é –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ñ–∞–∫—Ç —Å–¥–∞—á–∏.");
                window.location.href = '../index.html';
            }
        }
    </script>
</body>
</html>
