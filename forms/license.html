<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –õ–∏—Ü–µ–Ω–∑–∏—è | –ö–∞–ª—å—Ç–£—Å–ª—É–≥–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="../style.css">
    <style>
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –≤—Å–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        body {
            background-color: #0a0a0a !important;
            color: white !important;
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .auth-card {
            background: #141414;
            border: 1px solid #262626;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 600px;
        }

        h1 { color: #8b5cf6; margin-bottom: 5px; }
        .subtitle { color: #666; margin-bottom: 25px; }

        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-size: 13px;
            color: #8b5cf6;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤–≤–æ–¥–∞ */
        input, select {
            width: 100%;
            background: #000 !important;
            color: white !important;
            border: 1px solid #262626 !important;
            border-radius: 10px;
            padding: 12px;
            box-sizing: border-box;
            outline: none;
            font-size: 14px;
        }

        input:focus, select:focus {
            border-color: #8b5cf6 !important;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è) */
        input[readonly] {
            background: #0a0a0a !important;
            color: #555 !important;
            border-color: #1a1a1a !important;
        }

        .btn-main {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 25px;
            transition: 0.3s;
        }

        .btn-main:hover { background: #7c3aed; transform: translateY(-2px); }

        .btn-exit {
            background: transparent;
            color: #666;
            border: 1px solid #262626;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <div class="auth-card">
        <h1>üí≥ –í–û–î–ò–¢–ï–õ–¨–°–ö–ê–Ø –õ–ò–¶–ï–ù–ó–ò–Ø</h1>
        <p class="subtitle">–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–∏ —ç–∫–∑–∞–º–µ–Ω–∞</p>

        <div id="license-form">
            <label>–ò–º—è –∏ –§–∞–º–∏–ª–∏—è (Name):</label>
            <input type="text" id="lic-name" placeholder="Ivan Ivanov">

            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è (D.O.B):</label>
            <input type="text" id="lic-dob" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì">

            <label>–í–∞—à –∞–¥—Ä–µ—Å:</label>
            <input type="text" id="lic-address" placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –Ω–æ–º–µ—Ä –¥–æ–º–∞">

            <label>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:</label>
            <input type="text" id="lic-issue" placeholder="–ß–∏—Å–ª–æ/–ú–µ—Å—è—Ü/–ì–æ–¥">

            <label>–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:</label>
            <input type="text" id="lic-expiry" value="10 –ª–µ—Ç" readonly>

            <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
            <select id="lic-cat">
                <option value="A">A ‚Äî –¢—Ä–∞–∫–∏ / –ë–æ–ª—å—à–∏–µ –ø—Ä–∏—Ü–µ–ø—ã</option>
                <option value="B" selected>B ‚Äî –õ–µ–≥–∫–æ–≤—ã–µ (B+ –ú–µ—Ö–∞–Ω–∏–∫–∞)</option>
                <option value="C">C ‚Äî –¢—Ä–∞–∫–∏ / –°—Ä–µ–¥–Ω–∏–µ –ø—Ä–∏—Ü–µ–ø—ã</option>
            </select>

            <h3 style="margin-top: 25px; color: #8b5cf6; border-bottom: 1px solid #262626; padding-bottom: 5px;">–î–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞</h3>
            
            <label>Telegram –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞:</label>
            <input type="text" id="inst-tg" placeholder="@username">

            <label>–ù–∏–∫ –≤ Roblox –∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞:</label>
            <input type="text" id="inst-nick" placeholder="Roblox_Nick">

            <label>–û—Ü–µ–Ω–∫–∞ –∑–∞ —ç–∫–∑–∞–º–µ–Ω (1-10):</label>
            <input type="number" id="lic-score" min="1" max="10" placeholder="–û—Ç 1 –¥–æ 10">

            <button onclick="sendLicenseApp()" class="btn-main">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
            <button onclick="location.href='../index.html'" class="btn-exit">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞–∑–∞–¥</button>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://exbhxsdwqznmroxrzxjp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4Ymh4c2R3cXpubXJveHJ6eGpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDUzMzksImV4cCI6MjA4NzY4MTMzOX0.CUpzfJCrhghGNZKMK4xboXA7ZdSbYArWBSW4LpMevVk';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function sendLicenseApp() {
            const saved = localStorage.getItem('gvr_user');
            if(!saved) return alert("–í—ã –Ω–µ –≤–æ—à–ª–∏!");
            const user = JSON.parse(saved);

            const formData = {
                full_name: document.getElementById('lic-name').value,
                dob: document.getElementById('lic-dob').value,
                address: document.getElementById('lic-address').value,
                issue_date: document.getElementById('lic-issue').value,
                expiry: document.getElementById('lic-expiry').value,
                category: document.getElementById('lic-cat').value,
                instructor_tg: document.getElementById('inst-tg').value,
                instructor_nick: document.getElementById('inst-nick').value,
                score: document.getElementById('lic-score').value
            };

            if(!formData.full_name || !formData.instructor_nick || !formData.score) {
                return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
            }

            const { error } = await supabaseClient
                .from('applications')
                .insert([{ 
                    username: user.username, 
                    type: 'license', 
                    data: formData, 
                    status: 'pending' 
                }]);

            if (error) alert("–û—à–∏–±–∫–∞: " + error.message);
            else {
                alert("–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!");
                window.location.href = '../index.html';
            }
        }
    </script>
</body>
    </html>
