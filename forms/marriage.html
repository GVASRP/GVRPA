<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ë—Ä–∞–∫–∞ | –ö–∞–ª—å—Ç–£—Å–ª—É–≥–∏</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="../style.css">
</head>
<body style="display: block; padding: 40px 20px;">

    <div class="auth-card" style="max-width: 600px; margin: 0 auto;">
        <h1>üíç –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ë–†–ê–ö–ê</h1>
        <p class="subtitle">–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—é–∑–∞ –≤ —à—Ç–∞—Ç–µ GVRPA</p>

        <div id="marriage-form" style="text-align: left;">
            <h3 style="color: var(--accent-purple); border-bottom: 1px solid rgba(139, 92, 246, 0.3); padding-bottom: 5px;">–°—É–ø—Ä—É–≥–∏</h3>
            
            <label>1. –ù–∏–∫ –≤ Roblox –∏ —é–∑ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º–µ (–°—É–ø—Ä—É–≥ ‚Ññ1):</label>
            <input type="text" id="m-partner1" placeholder="Nick_Name –ø–µ—Ä–≤–æ–≥–æ">

            <label>2. –ù–∏–∫ –≤ Roblox –∏ —é–∑ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º–µ (–°—É–ø—Ä—É–≥ ‚Ññ2):</label>
            <input type="text" id="m-partner2" placeholder="Nick_Name –≤—Ç–æ—Ä–æ–≥–æ">

            <h3 style="margin-top: 25px; color: var(--accent-purple); border-bottom: 1px solid rgba(139, 92, 246, 0.3); padding-bottom: 5px;">–î–µ—Ç–∞–ª–∏ —Å–æ—é–∑–∞</h3>

            <label>3. –û–±—â–∞—è —Ñ–∞–º–∏–ª–∏—è –ø–æ—Å–ª–µ –±—Ä–∞–∫–∞:</label>
            <input type="text" id="m-surname" placeholder="–ö–∞–∫—É—é —Ñ–∞–º–∏–ª–∏—é –æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ?">

            <label>4. –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Ü–µ—Ä–µ–º–æ–Ω–∏–∏:</label>
            <input type="text" id="m-date" placeholder="–î–î.–ú–ú.–ì–ì–ì–ì | –ß–ß:–ú–ú">

            <label>5. –ù–∏–∫ —Å–≤–∏–¥–µ—Ç–µ–ª—è (–µ—Å–ª–∏ –±—ã–ª):</label>
            <input type="text" id="m-witness" placeholder="Nick_Name —Å–≤–∏–¥–µ—Ç–µ–ª—è">

            <label>6. –§–æ—Ç–æ/–°–∫—Ä–∏–Ω—à–æ—Ç —Å —Ü–µ—Ä–µ–º–æ–Ω–∏–∏ (—Å—Å—ã–ª–∫–∞):</label>
            <input type="text" id="m-proof" placeholder="https://imgur.com/...">

            <label>7. –ú–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è (–¶–µ—Ä–∫–æ–≤—å/–ú—ç—Ä–∏—è/–ü—Ä–∏—Ä–æ–¥–∞):</label>
            <input type="text" id="m-loc" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ü–µ—Ä–∫–æ–≤—å">

            <button onclick="sendMarriageApp()" class="btn-main" style="margin-top: 20px;">–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ –æ –±—Ä–∞–∫–µ</button>
            <button onclick="location.href='../index.html'" class="btn-exit" style="width: 100%; margin-top: 10px; border: none;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://exbhxsdwqznmroxrzxjp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4Ymh4c2R3cXpubXJveHJ6eGpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDUzMzksImV4cCI6MjA4NzY4MTMzOX0.CUpzfJCrhghGNZKMK4xboXA7ZdSbYArWBSW4LpMevVk';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function sendMarriageApp() {
            const user = JSON.parse(localStorage.getItem('gvr_user'));
            if(!user) return alert("–í—ã –Ω–µ –≤–æ—à–ª–∏!");

            const formData = {
                partner_1: document.getElementById('m-partner1').value,
                partner_2: document.getElementById('m-partner2').value,
                new_surname: document.getElementById('m-surname').value,
                wedding_date: document.getElementById('m-date').value,
                witness: document.getElementById('m-witness').value,
                evidence: document.getElementById('m-proof').value,
                location: document.getElementById('m-loc').value
            };

            if(!formData.partner_1  !formData.partner_2  !formData.new_surname) {
                return alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –Ω–∏–∫–∏ –æ–±–æ–∏—Ö —Å—É–ø—Ä—É–≥–æ–≤ –∏ –±—É–¥—É—â—É—é —Ñ–∞–º–∏–ª–∏—é!");
            }

            const { error } = await supabaseClient
                .from('applications')
                .insert([{ 
                    username: user.username, 
                    type: 'marriage', 
                    data: formData, 
                    status: 'pending' 
                }]);

            if (error) alert("–û—à–∏–±–∫–∞: " + error.message);
            else {
                alert("–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ó–∞—è–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –±—Ä–∞–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –ó–ê–ì–°.");
                window.location.href = '../index.html';
            }
        }
    </script>
</body>
</html>
