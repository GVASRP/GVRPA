<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö GVRPA | –ü–æ–ª–∏—Ü–∏—è</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg: #0a0a0a;
            --card-bg: #141414;
            --accent: #8b5cf6;
            --danger: #ef4444;
            --border: #262626;
        }
        body { background: var(--bg); color: white; font-family: sans-serif; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-exit { background: #333; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; }

        /* –ü–æ–∏—Å–∫ */
        .search-area { background: var(--card-bg); border: 1px solid var(--border); padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        input { width: 70%; padding: 12px; background: #000; border: 1px solid var(--border); color: white; border-radius: 8px; }
        .btn-search { width: 25%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –¥–æ—Å—å–µ */
        .dossier-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 20px; padding: 30px; display: none; }
        .wanted-tag { padding: 10px; border-radius: 8px; text-align: center; font-weight: bold; margin-bottom: 20px; }
        .status-red { background: rgba(239, 68, 68, 0.2); color: var(--danger); border: 1px solid var(--danger); }
        .status-green { background: rgba(16, 185, 129, 0.2); color: #10b981; border: 1px solid #10b981; }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .info-box { background: #000; padding: 15px; border-radius: 10px; border: 1px solid var(--border); }
        .label { color: #666; font-size: 12px; margin-bottom: 5px; text-transform: uppercase; }
        
        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .actions { display: flex; gap: 10px; margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px; }
        .btn-action { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; color: white; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>üìÇ –ì–û–°–£–î–ê–†–°–¢–í–ï–ù–ù–´–ô –†–ï–ï–°–¢–†</h1>
            <button onclick="location.href='index.html'" class="btn-exit">–í—ã—Ö–æ–¥</button>
        </div>

        <div class="search-area">
            <input type="text" id="search-nick" placeholder="–í–≤–µ–¥–∏—Ç–µ –ù–∏–∫ –∏–≥—Ä–æ–∫–∞...">
            <button onclick="searchPlayer()" class="btn-search">–ù–∞–π—Ç–∏ –¥–æ—Å—å–µ</button>
        </div>

        <div id="results" class="dossier-card">
            <div id="wanted-status" class="wanted-tag">–ó–ê–ì–†–£–ó–ö–ê...</div>
            
            <h2 id="res-nick" style="margin:0; font-size: 28px; color: var(--accent);">NICKNAME</h2>
            <p id="res-fullname" style="color: #aaa; margin-top: 5px;">–ò–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ</p>

            <div class="info-grid">
                <div class="info-box"><div class="label">–°–µ–º—å—è</div><div id="res-spouse">–•–æ–ª–æ—Å—Ç</div></div>
                <div class="info-box"><div class="label">–í–æ–¥. –ü—Ä–∞–≤–∞</div><div id="res-license">–ù–µ—Ç</div></div>
                <div class="info-box" style="grid-column: span 2;"><div class="label">–ú–µ—Å—Ç–æ –∂–∏—Ç–µ–ª—å—Å—Ç–≤–∞</div><div id="res-address">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div></div>
                <div class="info-box" style="grid-column: span 2;"><div class="label">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</div><div id="res-cars">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div></div>
            </div>

            <div class="actions">
                <button onclick="updateDB('is_wanted', true)" class="btn-action" style="background: var(--danger);">–í –†–û–ó–´–°–ö</button>

<button onclick="updateDB('is_wanted', false)" class="btn-action" style="background: #333;">–°–ù–Ø–¢–¨ –†–û–ó–´–°–ö</button>
                <button onclick="updateDB('has_license', true)" class="btn-action" style="background: #10b981;">–í–´–î–ê–¢–¨ –ü–†–ê–í–ê</button>
            </div>
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://exbhxsdwqznmroxrzxjp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4Ymh4c2R3cXpubXJveHJ6eGpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDUzMzksImV4cCI6MjA4NzY4MTMzOX0.CUpzfJCrhghGNZKMK4xboXA7ZdSbYArWBSW4LpMevVk';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
// –í—Å—Ç–∞–≤—å —ç—Ç–æ –≤ –Ω–∞—á–∞–ª–æ —Å–∫—Ä–∏–ø—Ç–∞ –≤ police.html
(function checkAccess() {
    const userStr = localStorage.getItem('gvr_user');
    if (!userStr) { window.location.href = 'index.html'; return; }
    const user = JSON.parse(userStr);
    if (user.role !== 'admin' && user.role !== 'police') {
        alert("–î–û–°–¢–£–ü –ó–ê–ü–†–ï–©–ï–ù!");
        window.location.href = 'index.html';
    }
})();
        let currentTarget = "";

        async function searchPlayer() {
            const nick = document.getElementById('search-nick').value.trim();
            if(!nick) return;

            // –¢–µ–ø–µ—Ä—å –∏—â–µ–º –≤ —Ç–∞–±–ª–∏—Ü–µ CITIZENS (–Ω–∞—à–∞ –Ω–æ–≤–∞—è –±–∞–∑–∞)
            const { data, error } = await supabaseClient
                .from('citizens')
                .select('*')
                .eq('roblox_nick', nick)
                .single();

            if (error || !data) {
                alert("–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –±–∞–∑–µ.");
                document.getElementById('results').style.display = 'none';
                return;
            }

            currentTarget = nick;
            showDossier(data);
        }

        function showDossier(data) {
            const res = document.getElementById('results');
            res.style.display = 'block';

            document.getElementById('res-nick').innerText = data.roblox_nick;
            document.getElementById('res-fullname').innerText = data.full_name || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
            document.getElementById('res-spouse').innerText = data.spouse || "–ù–µ—Ç";
            document.getElementById('res-address').innerText = data.address || "–ë–æ–º–∂";
            document.getElementById('res-cars').innerText = data.car_data || "–ù–µ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞";
            document.getElementById('res-license').innerText = data.has_license ? "–î–ï–ô–°–¢–í–ò–¢–ï–õ–¨–ù–´" : "–û–¢–°–£–¢–°–¢–í–£–Æ–¢";

            const status = document.getElementById('wanted-status');
            if(data.is_wanted) {
                status.innerText = "‚ö† –í–ù–ò–ú–ê–ù–ò–ï: –í –†–û–ó–´–°–ö–ï";
                status.className = "wanted-tag status-red";
            } else {
                status.innerText = "–í –†–û–ó–´–°–ö–ï –ù–ï –ó–ù–ê–ß–ò–¢–°–Ø";
                status.className = "wanted-tag status-green";
            }
        }

        async function updateDB(field, value) {
            if(!currentTarget) return;
            const updates = {};
            updates[field] = value;

            const { error } = await supabaseClient
                .from('citizens')
                .update(updates)
                .eq('roblox_nick', currentTarget);

            if(!error) {
                alert("–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∞!");
                searchPlayer(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ—É –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            }
        }
    </script>
</body>
</html>
