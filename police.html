<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö GVRPA | –ü–æ–ª–∏—Ü–∏—è</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body style="display: block; padding: 20px;">

    <div class="container" style="max-width: 900px; margin: 0 auto;">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <h1>üìÇ –ì–û–°–£–î–ê–†–°–¢–í–ï–ù–ù–´–ô –†–ï–ï–°–¢–†</h1>
            <button onclick="location.href='index.html'" class="btn-exit">–í—ã—Ö–æ–¥</button>
        </div>

        <div class="auth-card" style="margin: 20px 0; max-width: 100%;">
            <input type="text" id="search-nick" placeholder="–í–≤–µ–¥–∏—Ç–µ –ù–∏–∫ –∏–≥—Ä–æ–∫–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏..." style="margin-bottom: 0;">
            <button onclick="searchPlayer()" class="btn-main" style="margin-top: 15px;">–ù–∞–π—Ç–∏ –¥–æ—Å—å–µ</button>
        </div>

        <div id="results">
            </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://exbhxsdwqznmroxrzxjp.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4Ymh4c2R3cXpubXJveHJ6eGpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDUzMzksImV4cCI6MjA4NzY4MTMzOX0.CUpzfJCrhghGNZKMK4xboXA7ZdSbYArWBSW4LpMevVk';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        async function searchPlayer() {
            const nick = document.getElementById('search-nick').value.trim();
            if(!nick) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫!");

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p class="subtitle">–ü–æ–∏—Å–∫ –≤ –∞—Ä—Ö–∏–≤–∞—Ö...</p>';

            // –ò—â–µ–º –≤ —Ç–∞–±–ª–∏—Ü–µ applications —Ç–æ–ª—å–∫–æ –û–î–û–ë–†–ï–ù–ù–´–ï (approved) –∑–∞–ø–∏—Å–∏
            const { data, error } = await supabaseClient
                .from('applications')
                .select('*')
                .eq('status', 'approved')
                .ilike('username', nick); // –ò—â–µ–º –ø–æ –Ω–∏–∫—É (—Ä–µ–≥–∏—Å—Ç—Ä –Ω–µ –≤–∞–∂–µ–Ω)

            resultsDiv.innerHTML = '';

            if (data.length === 0) {
                resultsDiv.innerHTML = '<div class="card" style="border: 1px solid #ef4444;">‚ùå –ì—Ä–∞–∂–¥–∞–Ω–∏–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</div>';
                return;
            }

            data.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.textAlign = 'left';
                card.style.marginBottom = '15px';

                let info = '';
                if (typeof item.data === 'object') {
                    info = Object.entries(item.data)
                        .map(([key, val]) => <b>${key}:</b> ${val})
                        .join('<br>');
                } else {
                    info = item.data;
                }

                card.innerHTML = 
                    <div style="border-bottom: 1px solid rgba(139, 92, 246, 0.3); padding-bottom: 5px; margin-bottom: 10px;">
                        <span style="color: var(--accent-purple); font-weight: bold; text-transform: uppercase;">${item.type}</span>
                    </div>
                    <div style="font-size: 14px; line-height: 1.6;">${info}</div>
                ;
                resultsDiv.appendChild(card);
            });
        }
    </script>
</body>
</html>
